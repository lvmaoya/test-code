<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Main App</title>
    <style>
      body {
        font-family: sans-serif;
      }
      nav a {
        margin-right: 10px;
      }
      #sub-container {
        border: 1px solid #ccc;
        padding: 10px;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <h1>Main App</h1>
    <nav>
      <a href="#/subapp1">子应用 1</a>
      <a href="#/subapp2">子应用 2</a>
    </nav>

    <div id="sub-container">子应用将加载在此处</div>

    <script>
      const apps = {
        subapp1: "http://127.0.0.1:5500/micro/micro-frontend-demo/subapp1/index.html",
        subapp2: "http://127.0.0.1:5500/micro/micro-frontend-demo/subapp2/index.html",
      };

      async function loadApp(appName) {
        const url = apps[appName];
        if (!url) return;

        const html = await fetch(url).then((res) => res.text());
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, "text/html");

        const container = document.getElementById("sub-container");
        container.innerHTML = ""; // 清空内容

        // 加载样式
        doc.querySelectorAll('link[rel="stylesheet"]').forEach((link) => {
          const newLink = document.createElement("link");
          newLink.rel = "stylesheet";
          newLink.href = new URL(link.href, url).toString();
          document.head.appendChild(newLink);
        });

        // 插入 body 内容（简单）
        container.innerHTML = doc.body.innerHTML;

        // 加载脚本
        doc.querySelectorAll("script").forEach((script) => {
          const newScript = document.createElement("script");
          if (script.src) {
            newScript.src = new URL(script.src, url).toString();
          } else {
            newScript.textContent = script.textContent;
          }
          container.appendChild(newScript);
        });
      }

      function handleHashChange() {
        const appName = location.hash.replace("#/", "");
        loadApp(appName);
      }

      window.addEventListener("hashchange", handleHashChange);
      handleHashChange(); // 初始加载
    </script>
  </body>
</html>
